var ajax={send:function(e){if("object"==typeof e){e.async=e.async||!0,e.dataType=e.dataType||"html",e.data=e.data||!1,e.type=e.type||"GET";var t=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");t.onreadystatechange=function(){"function"==typeof e.beforeSend&&e.beforeSend(),4===t.readyState&&200===t.status?"function"==typeof e.success&&("html"===e.dataType&&e.success(t.responseText),"xml"===e.dataType&&e.success(t.responseXML),"json"===e.dataType&&e.success(ajax.parseJSON(t.responseText))):"function"==typeof e.error&&e.error()},(type=~["GET","DELETE","POST","PUT","HEAD"].indexOf(e.type))&&("GET"===e.type?(t.open("GET",e.url+"?"+ajax.toQueryString(e.data),!0),t.setRequestHeader("X-Requested-With","XMLHttpRequest"),t.send(null)):(t.open(e.type,e.url,!0),t.setRequestHeader("Content-type","application/x-www-form-urlencoded"),t.setRequestHeader("X-Requested-With","XMLHttpRequest"),t.send(ajax.toQueryString(e.data))))}},parseJSON:function(e){if("string"!=typeof e||!e||""===e)return null;if(e=e.replace(/^\s+/,""),e=e.replace(/\s+$/,""),window.JSON&&window.JSON.parse)return window.JSON.parse(e);var t=/^[\],:{}\s]*$/,n=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,a=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,r=/(?:^|:|,)(?:\s*\[)+/g;return t.test(e.replace(n,"@").replace(a,"]").replace(r,""))?new Function("return "+e)():void 0},toQueryString:function(e){var t,n,a,r="",o=function(e,t){r+=encodeURIComponent(e)+"="+encodeURIComponent(t)+"&"};for(n in e)if(Object.hasOwnProperty.call(e,n))if(a=e[n],"object"==typeof e&&e instanceof Array)for(t=0;t<a.length;t++)o(n,a[t]);else o(n,e[n]);return r.replace(/&$/,"").replace(/%20/g,"+")}},EA_LoadThumb,EA_cacheImage,EA_loadImage;EA_LoadThumb=function(e){var t,n;return e.img.setAttribute("onerror",""),e.img.src=EA_ext_path()+"/loading",n=document.createElement("div"),n.setAttribute("overflow","hidden"),n.setAttribute("position","relative"),n=e.img.parentNode.appendChild(n),t=document.createElement("iframe"),t.setAttribute("style","position: absolute;top:0px;left:4000px;width:1200px;height:800px;"),t.setAttribute("id","testing"),t=n.appendChild(t),t.src=php+"&html=true",t.onload=function(){var n,a;return n=t.contentDocument||t.contentWindow.document,a=n.getElementsByTagName("body")[0],EA_loadImage(a,e.img,e.data)}},EA_loadImage=function(e,t){var n;return n={logging:!0,proxy:EA_ext_path()+"/proxy",onrendered:function(e){var n;return t.onerror=function(){return t.onerror=null,window.console.log?window.console.log("Not loaded image from canvas.toDataURL"):alert("Not loaded image from canvas.toDataURL")},n=e.toDataURL("image/png"),t.src=n,EA_cacheImage(n)},height:800,background:"#fff"},html2canvas(e,n)},EA_cacheImage=function(e){var t,n;return t=!1,n={url:EA_ext_path()+"/insert",data:{data:encodeURIComponent(e)},type:"POST",dataType:"html",beforeSend:function(){return t?alert("About to send datas!"):void 0},success:function(e){return console.log(e)},error:function(){return t?alert("There was an error sending data"):void 0}},ajax.send(n)};